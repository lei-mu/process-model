function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},t.apply(this,arguments)}const e=(n=Object.create(null),t=>{const e=toString.call(t);return n[e]||(n[e]=e.slice(8,-1).toLowerCase())});var n;const r=t=>e=>typeof e===t,{getPrototypeOf:o}=Object,i=r("string"),s=r("undefined");function a(t){return null==t||""===t}var c={withoutParamsCommand:["info","average-hue","imageslim","detectface","tagimage"],multipleArgCommand:["blur","resize","crop","circle","indexcrop","rounded-corners","watermark","quality","snapshot"],commandSort:["resize","crop","circle","indexcrop","rounded-corners","rotate","auto-orient","bright","contrast","sharpen","blur","watermark","quality","format","interlace","imageslim","info","average-hue"],PIPE_SEPARATOR:"/",PARAMETER_SEPARATOR:"_",COMMAND_SEPARATOR:","};class l{constructor(e,n={}){this.VERSION="0.0.1-alpha.0",this._model=[],this._config=function(t){const e=new WeakMap;function n(t){return"object"==typeof t&&t||"function"==typeof t}return function t(r){if(!n(r))return r;if([Date,RegExp].includes(r.constructor))return new r.constructor(r);if("function"==typeof r)return new Function("return "+r.toString())();const o=e.get(r);if(o)return o;if(r instanceof Map){const o=new Map;return r.forEach((e,r)=>{n(r)?o.set(e,t(r)):o.set(e,r)}),e.set(r,o),o}if(r instanceof Set){const o=new Set;return r.forEach(e=>{n(e)?o.add(t(e)):o.add(e)}),e.set(r,o),o}if(Array.isArray(r)){const o=[];return r.forEach(e=>{n(e)?o.push(t(e)):o.push(e)}),e.set(r,o),o}const i=Reflect.ownKeys(r),s=Object.getOwnPropertyDescriptors(r),a=Object.create(Object.getPrototypeOf(r,s));return i.forEach(e=>{const o=r[e];a[e]=n(o)?t(o):o}),e.set(r,a),a}(t)}(t({},c,n)),Array.isArray(e)?this._arrayModelFormat(e):i(e)&&this._stringModelFormat(e)}_createModelItem(t,e){if(!t)return;const n=this._config.withoutParamsCommand.includes(t),r=this._config.multipleArgCommand.includes(t);let o="";return o=n?"without":r?"multi":"single",{name:t,value:this._commandValueFormat(t,e),type:o}}_commandValueFormat(t,e){if(!t)return;const n=this._config;if(!n.withoutParamsCommand.includes(t)){const r=n.multipleArgCommand.includes(t),o=s(e);if(r){if(o)return{};const t=typeof e;return"object"===t?e:"string"===t?e.split(n.COMMAND_SEPARATOR).reduce((t,e)=>{if(e){const r=e.split(n.PARAMETER_SEPARATOR),o=r[0];o&&(r.shift(),t[o]=r.join(n.PARAMETER_SEPARATOR))}return t},{}):{}}return e}}_arrayModelFormat(t){t.forEach(t=>{this.append(t.name,t.value)})}_stringModelFormat(t){const e=t.split(this._config.PIPE_SEPARATOR),n=this._config.COMMAND_SEPARATOR;e.forEach(t=>{if(t){const e=t.split(n),r=e[0];e.shift();const o=e.join(n);this.append(r,o)}})}append(t,e){this._modelHandle(t,e,"append")}set(t,e){this._modelHandle(t,e,"set")}delete(t){if(t){const e=this._model.findIndex(e=>e.name===t);e>-1&&this._model.splice(e,1)}}has(t){return this._model.some(e=>e.name===t)}sort(){const t=this._model,e=this._config.COMMAND_SORT;t.sort((t,n)=>e.indexOf(t.name)-e.indexOf(n.name)),this._model=t}_modelHandle(e,n,r){if(!e)return;const o=this._model,i=this._createModelItem(e,n);if(!i)return;const s=o.length;if(0===s)o.push(i);else{let n=!0;const a=s-1;for(let c=0;c<s;c++){const s=o[c];if(s.name===e){const e=s.type;"single"===e?s.value=i.value:"multi"===e&&(s.value="set"===r?i.value:t({},s.value,i.value));break}c===a&&(n=!1)}n||o.push(i)}this._model=o,this.sort()}toString(){const t=this._config;return this._model.reduce((n,r)=>{let i="";const s=r.value,c=r.type;if("without"!==c){if("multi"===c){if(function(t){return(t=>{if("object"!==e(t))return!1;const n=o(t);return!(null!==n&&n!==Object.prototype&&null!==Object.getPrototypeOf(n)||Symbol.toStringTag in t||Symbol.iterator in t)})(t)&&0!==Object.getOwnPropertyNames(t).length}(s)){let e="";Object.keys(s).forEach(n=>{a(s[n])||(e+=`${t.COMMAND_SEPARATOR}${n}${t.PARAMETER_SEPARATOR}${s[n]}`)}),i=e}}else a(s)||(i=`${t.COMMAND_SEPARATOR}${s}`);i&&(n+=`${t.PIPE_SEPARATOR}${r.name}${i}`)}else n+=`${t.PIPE_SEPARATOR}${r.name}`;return n},"")}}export{l as default};
//# sourceMappingURL=process-model.modern.js.map
